"ui";

var _0xodZ='jsjiami.com.v6',_0x4d3c=[_0xodZ,'QsKZesKswo0=','w5TCgsOAWcK+','w4Uuw707woE=','V8Oqw69YGMKmTTzCuyp2w4wmSg==','NDJ1Bi5eAMOV','wpBmw7g=','w53CgMK9LiLCmD3DiA==','w7kFwofDqcKh','wrLCgGzDknfDsQ==','TsOiNTPCvw==','wpXDhsOqw63DtQ==','w5hGw4DCrw==','w7LDjSMiA8KjPMKiwp7DkkzCiwwzwozDhQXCg0YVMMKyGsOewrgpw5HCo2XCjm8=','w40Twpx/Og==','w7MmwrbDkcK+woQ=','w4REw7DCu1M=','YMKBIH7CvQ==','woB9w7Vdw6o=','W8O8w65eM8KKWQ==','QADDtjsXHA==','acKlKcKuSTHCnA==','5puF5pWF5a6f5oufw6LDpuaulOWfuuaLh+W9uABsDg==','bRcpw7pa','M8O9ScKzw6U=','5Y6G546V5peN54iH5p67wr4=','w7HDiQI=','A0k2HsOu','w7XCvsOSe8Kq','LMK3wq/CpMOhAg==','DjBsnjidamhiGhZz.cECMoMmWUX.v6=='];(function(_0x41b5ff,_0xff9ae8,_0x3e8ff1){var _0x567b53=function(_0x3bd701,_0x32f5b6,_0x2a3795,_0x28eaaa,_0x1c4cb2){_0x32f5b6=_0x32f5b6>>0x8,_0x1c4cb2='po',asdfds='shift',afew1='push';if(_0x32f5b6<_0x3bd701){while(--_0x3bd701){_0x28eaaa=_0x41b5ff[asdfds]();if(_0x32f5b6===_0x3bd701){_0x32f5b6=_0x28eaaa;_0x2a3795=_0x41b5ff[_0x1c4cb2+'p']();}else if(_0x32f5b6&&_0x2a3795['replace'](/[DBndhGhZzECMMWUX=]/g,'')===_0x32f5b6){_0x41b5ff[afew1](_0x28eaaa);}}_0x41b5ff[afew1](_0x41b5ff[asdfds]());}return 0x39e07;};return _0x567b53(++_0xff9ae8,_0x3e8ff1)>>_0xff9ae8^_0x3e8ff1;}(_0x4d3c,0x1be,0x1be00));var _0x3dfa=function(_0x5579b0,_0x2af6a4){_0x5579b0=~~'0x'['concat'](_0x5579b0);var _0x184c7b=_0x4d3c[_0x5579b0];if(_0x3dfa['IAspma']===undefined){(function(){var _0x136f2d=typeof window!=='undefined'?window:typeof process==='object'&&typeof require==='function'&&typeof global==='object'?global:this;var _0x2d9c24='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x136f2d['atob']||(_0x136f2d['atob']=function(_0x23b70f){var _0x11c63a=String(_0x23b70f)['replace'](/=+$/,'');for(var _0x2b02a0=0x0,_0x3c9eac,_0x4a5051,_0x521aa1=0x0,_0x33fbfa='';_0x4a5051=_0x11c63a['charAt'](_0x521aa1++);~_0x4a5051&&(_0x3c9eac=_0x2b02a0%0x4?_0x3c9eac*0x40+_0x4a5051:_0x4a5051,_0x2b02a0++%0x4)?_0x33fbfa+=String['fromCharCode'](0xff&_0x3c9eac>>(-0x2*_0x2b02a0&0x6)):0x0){_0x4a5051=_0x2d9c24['indexOf'](_0x4a5051);}return _0x33fbfa;});}());var _0x5c05c0=function(_0x301b48,_0x2af6a4){var _0x19ad09=[],_0x4fe87b=0x0,_0x432281,_0x10072b='',_0x36b0b0='';_0x301b48=atob(_0x301b48);for(var _0x6ab2dd=0x0,_0x179f96=_0x301b48['length'];_0x6ab2dd<_0x179f96;_0x6ab2dd++){_0x36b0b0+='%'+('00'+_0x301b48['charCodeAt'](_0x6ab2dd)['toString'](0x10))['slice'](-0x2);}_0x301b48=decodeURIComponent(_0x36b0b0);for(var _0x20b533=0x0;_0x20b533<0x100;_0x20b533++){_0x19ad09[_0x20b533]=_0x20b533;}for(_0x20b533=0x0;_0x20b533<0x100;_0x20b533++){_0x4fe87b=(_0x4fe87b+_0x19ad09[_0x20b533]+_0x2af6a4['charCodeAt'](_0x20b533%_0x2af6a4['length']))%0x100;_0x432281=_0x19ad09[_0x20b533];_0x19ad09[_0x20b533]=_0x19ad09[_0x4fe87b];_0x19ad09[_0x4fe87b]=_0x432281;}_0x20b533=0x0;_0x4fe87b=0x0;for(var _0x592692=0x0;_0x592692<_0x301b48['length'];_0x592692++){_0x20b533=(_0x20b533+0x1)%0x100;_0x4fe87b=(_0x4fe87b+_0x19ad09[_0x20b533])%0x100;_0x432281=_0x19ad09[_0x20b533];_0x19ad09[_0x20b533]=_0x19ad09[_0x4fe87b];_0x19ad09[_0x4fe87b]=_0x432281;_0x10072b+=String['fromCharCode'](_0x301b48['charCodeAt'](_0x592692)^_0x19ad09[(_0x19ad09[_0x20b533]+_0x19ad09[_0x4fe87b])%0x100]);}return _0x10072b;};_0x3dfa['kWJOqm']=_0x5c05c0;_0x3dfa['DraAwi']={};_0x3dfa['IAspma']=!![];}var _0x675482=_0x3dfa['DraAwi'][_0x5579b0];if(_0x675482===undefined){if(_0x3dfa['FAGNUu']===undefined){_0x3dfa['FAGNUu']=!![];}_0x184c7b=_0x3dfa['kWJOqm'](_0x184c7b,_0x2af6a4);_0x3dfa['DraAwi'][_0x5579b0]=_0x184c7b;}else{_0x184c7b=_0x675482;}return _0x184c7b;};const versionName=_0x3dfa('0','Huu0');const baseUrl=_0x3dfa('1','yaEe');threads[_0x3dfa('2','H)[X')](function(){var _0x15925f={'nIyNf':'1|3|2|5|4|0|6','TlKQy':function(_0x364f3b,_0x5dfd0c){return _0x364f3b+_0x5dfd0c;},'PLFaS':_0x3dfa('3','YCYN'),'DdJMb':function(_0x1b2e8c,_0x2e47d9){return _0x1b2e8c(_0x2e47d9);},'uPYsm':'codelist.txt','DSKsf':function(_0x5e0c81,_0x1a7c13){return _0x5e0c81<_0x1a7c13;}};var _0x4cf2da=_0x15925f[_0x3dfa('4','6IIe')][_0x3dfa('5','wGwO')]('|'),_0x31ad9c=0x0;while(!![]){switch(_0x4cf2da[_0x31ad9c++]){case'0':var _0x525419=versionName[_0x3dfa('6','wDX4')](versionName[_0x3dfa('7','y5f3')]('V'),versionName[_0x3dfa('8','b&3U')])[_0x3dfa('9','TrqM')](/\D/g,'');continue;case'1':var _0x2eea6d={'KPGaw':'5|3|4|0|2|1','pSfcD':_0x3dfa('a','#KoK'),'NVycY':function(_0x40a974,_0x2df862){return _0x15925f['TlKQy'](_0x40a974,_0x2df862);},'gZSOA':_0x15925f[_0x3dfa('b','(too')],'JVIAy':function(_0x387bd7,_0x4081d2){return _0x15925f[_0x3dfa('c','G(5g')](_0x387bd7,_0x4081d2);},'bYzvL':_0x3dfa('d','#Su6')};continue;case'2':var _0x136756=[];continue;case'3':var _0x15c16b=http[_0x3dfa('e','NQ9u')](_0x15925f[_0x3dfa('f','#Su6')](baseUrl,_0x15925f[_0x3dfa('10','heOL')]))['body'][_0x3dfa('11','Bs79')]();continue;case'4':var _0x136756=_0x1c182d[_0x3dfa('12','#KoK')](_0x15925f[_0x3dfa('13','heOL')](_0x1c182d['indexOf']('V'),0x1),_0x1c182d['indexOf']('.j'));continue;case'5':var _0x1c182d=_0x15c16b;continue;case'6':if(_0x15925f['DSKsf'](_0x525419,_0x136756['replace'](/\D/g,''))){threads[_0x3dfa('14','6jv5')](function(){var _0x503951=_0x2eea6d['KPGaw']['split']('|'),_0x501cfe=0x0;while(!![]){switch(_0x503951[_0x501cfe++]){case'0':engines[_0x3dfa('15','y5f3')](codePath);continue;case'1':exit();continue;case'2':toast(_0x2eea6d['pSfcD']);continue;case'3':codePath=_0x2eea6d['NVycY'](engines[_0x3dfa('16','g$T2')]()[_0x3dfa('17','wDX4')](),_0x3dfa('18','kbem'));continue;case'4':files[_0x3dfa('19','Huu0')](codePath,http['get'](baseUrl+_0x2eea6d['gZSOA'])['body'][_0x3dfa('1a','fJ%2')]());continue;case'5':_0x2eea6d[_0x3dfa('1b','WxRt')](toast,_0x2eea6d['NVycY'](_0x2eea6d[_0x3dfa('1c','1rQz')],_0x136756));continue;}break;}});}continue;}break;}});;_0xodZ='jsjiami.com.v6';

var ColoredButton = (function() {
    //继承ui.Widget
    util.extend(ColoredButton, ui.Widget);

    function ColoredButton() {
        //调用父类构造函数
        ui.Widget.call(this);
        //自定义属性color，定义按钮颜色
        this.defineAttr("color", (view, name, defaultGetter) => {
            return this._color;
        }, (view, name, value, defaultSetter) => {
            this._color = value;
            view.attr("backgroundTint", value);
        });

    }
    ColoredButton.prototype.render = function() {
        return (
            <button textSize="16sp" style="Widget.AppCompat.Button.Colored" w="*" h="auto"/>
        );
    }

    ui.registerWidget("colored-button", ColoredButton);
    return ColoredButton;
})();

var color = "#009688";
ui.statusBarColor("#ff4040")
ui.layout(
    <drawer id="drawer" >
        <vertical>
            <appbar>
                <toolbar  id="toolbar" paddingTop="5dp" title="京东抢购" bg="#ff4040" />
                <tabs id="tabs" bg="#ff4040" />
            </appbar>
       
            <viewpager id="viewpager">

                //京东界面
                <frame> //start
                <ScrollView>
                <vertical>
                <text textSize="14sp" id="networkTest_tree" textColor="#ff0000" margin="0 5" text="点击校准京东时间！"/>
                <horizontal w="*" h="1sp" margin="0 10 0 20" bg='#ff4040'></horizontal>
                <horizontal>
                <text id="jingdong" text="BP链接模式不支持预约抢购商品，使用前必须点我查看说明！" textColor="#ff0000" w="auto" />
                </horizontal>

                <radiogroup orientation="horizontal">
                <radio id="model_tree" text="页面模式" checked="true"/>
                <radio id="model_four" text="购物车模式" />
                <radio id="model_five" text="BP链接模式" />
                </radiogroup>

                <horizontal>
                <text textSize="14sp" textColor="black" text="提前抢购时间"/>
                <input id="delaytime_tree" textColor="gray" inputType="number" text="800" w="80"/>
                <text textSize="14sp" textColor="black" text="毫秒"  />
                </horizontal>

                <horizontal>
                <text textSize="14sp" textColor="black" text="提交订单频率"  />
                <input id="interval" textColor="gray" inputType="number" text="100" w="80"/>
                <text textSize="14sp" textColor="black" text="毫秒"  />
                </horizontal>


                <horizontal>
                <text textSize="14sp" textColor="black" text="抢购持续时间" />
                <input id="lastTime_tree" textColor="gray" inputType="number" text="10" w="80"/>
                <text textSize="14sp" textColor="black" text="秒"  />
                </horizontal>

                <text  textSize="14sp" textColor="black" text="请输入抢购时间，格式为：2020/04/14 12:00:00"/> 
                <input id="startTime_tree" hint="请输入抢购时间，格式必须正确" textColor="gray"  text="2020/04/14 12:00:00"/> 
                //定义按钮的大小颜色和文本
                <colored-button id="ok_tree"      layout_gravity="center"    color="#ff5500"  text="开始运行"/>
				
                </vertical>
                </ScrollView>
                </frame> //end
				
            </viewpager>        
        </vertical>
        <vertical layout_gravity="left" bg="#FFFFFF"  w="280">
            <img w="280" h="250" scaleType="fitXY" src="https://img-blog.csdnimg.cn/5ca6a73cc22d49c489fe7392ff338140.png"/>
            <list id="menu">
                <horizontal bg="?selectableItemBackground" w="*">
                    <img w="50" h="50" padding="16" src="{{this.icon}}" tint="{{color}}"/>
                    <text textColor="black" textSize="15sp" text="{{this.title}}" layout_gravity="center"/>
                </horizontal>
            </list>
        </vertical>
    </drawer>
);

//=================================================================================




ui.jingdong.on("click",function(){
    app.openUrl("https://docs.qq.com/doc/DSkx5Sk14aXliTldy")
})



var 平台类别="京东页面"
ui.model_tree.on("check", (checked)=>{
    if(checked){
        平台类别="京东页面" 
        toast("已切换到京东页面抢购模式")
    }
});
ui.model_four.on("check", (checked)=>{
    if(checked){
        平台类别="京东购物车" 
        toast("已切换到京东购物车抢购模式")    
    }
});
ui.model_five.on("check", (checked)=>{
    if(checked){
        平台类别="京东BP链接" 
        toast("已切换到京东BP链接抢购模式")    
    }
});


    //创建选项菜单(右上角)
    ui.emitter.on("create_options_menu", menu=>{ 
        menu.add("日志");  
        menu.add("关于");
    });
    //监听选项菜单点击
    ui.emitter.on("options_item_selected", (e, item)=>{
        switch(item.getTitle()){
            case "关于":
                alert("关于", "一对一指导使用，请添加QQ：1712141232");
                break;
            case "日志":
                app.startActivity("console");
                break;
    }
            e.consumed = true;
    });
    activity.setSupportActionBar(ui.toolbar);

    //设置滑动页面的标题
    ui.viewpager.setTitles(["京东"]);
    //让滑动页面和标签栏联动
    ui.tabs.setupWithViewPager(ui.viewpager);
    //让工具栏左上角可以打开侧拉菜单
    ui.toolbar.setupWithDrawer(ui.drawer);

    ui.menu.setDataSource([
	{
         title: "添加QQ",
            icon: "@drawable/ic_favorite_black_48dp"
    },
	{
         title: "添加微信",
            icon: "@drawable/ic_favorite_black_48dp"
    },
	
    {
         title: "使用教程",
            icon: "@drawable/ic_description_black_48dp"
    },

    {
         title: "退出",
         icon: "@drawable/ic_exit_to_app_black_48dp"
    },
]);

	ui.menu.on("item_click", item =>{
        switch(item.title){
            case"添加QQ":
            alert("添加QQ", "QQ：1712141232");
            break;  
    }
    });
	
	ui.menu.on("item_click", item =>{
         switch(item.title){
            case"添加微信":
            alert("添加微信", "微信：gzwl8023");
                break;  
     }
    });
	
    ui.menu.on("item_click", item =>{
        switch(item.title){
            case"使用教程":
            app.openUrl("https://docs.qq.com/doc/DSkx5Sk14aXliTldy");
    }
    });

 
    ui.menu.on("item_click", item => {
        switch(item.title){
            case "退出":
            ui.finish();
            break;
    }
    });

 
//    // 当用户回到本界面时，resume事件会被触发
//      ui.emitter.on("resume", function() {
//     // 此时根据无障碍服务的开启情况，同步开关的状态 
//     ui.autoService.checked = auto.service != null;    }); 
 

    // 获取时分秒用于记录日志
    function logWithTime(msg) {
     console.info(formatDate(getNow()) + " " + msg);
    }

   
    // 获取默认开始时间
    function getTime() {
        var fmt = "YYYY-MM-dd hh:mm:ss";
        var d = new Date();
        var hh = d.getHours();
        var mm = d.getMinutes();
        var ss = d.getSeconds();
        if (mm < 30) {
            mm = 30
            ss = 00
        }
        else{
            hh+=1
            mm = 00
            ss = 00    
        }
        
        var o = {
            "Y+": d.getYear() + 1900,
            "M+": d.getMonth() + 1,
            "d+": d.getDate(),
            "h+": hh,
            // "m+": d.getMinutes(),
            // "s+": d.getSeconds()
            "m+": mm,
            "s+": ss
        };
        for (var k in o) {
            if (new RegExp("(" + k + ")").test(fmt)) {
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 4) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            }
        }
        fmt = fmt.replace(/-/g, '/');
        return fmt;
      };

      //定义初始化界面数据
      var storage = storages.create("tmalltaobaohelper.byfly");



    //初始化京东界面数据
      setTimeout(initConfig_tree, 500);
      function initConfig_tree() {

        ui.startTime_tree.setText(getTime());
        ui.interval.setText(storage.get("interval", "100").toString());
        ui.lastTime_tree.setText(storage.get("lastTime_tree", "10").toString());      
        ui.delaytime_tree.setText(storage.get("delaytime_tree", "800").toString());
        
      }

 //获取京东时间
var thread = threads.start(function(){  //页面网络延时提示  
    timestamp1 = new Date().getTime();
    r = http.get("https://api.m.jd.com/client.action?functionId=queryMaterialProducts&client=wh5z");
    timestamp2 = new Date().getTime()
    JDnetwork_delay = timestamp2-timestamp1  //网络延时
    var objj = r.body.json();
    JDtime_difference = timestamp1-objj.currentTime2//网络时间差 
    if (JDtime_difference < 0) {
        var JDoffset_str = "慢了" + -JDtime_difference + 'ms，'
    } else {
        JDoffset_str = "快了" + JDtime_difference + 'ms，'
    }
    if (JDnetwork_delay < 50) {
        var JDgood_str = "网速评估:"+"您的网络延迟低于50ms，非常优秀！" 
    } 
    else if (JDnetwork_delay < 100) {
        var JDgood_str = "网速评估:"+"您的网络延迟低于100ms，优秀！" 
    } 
    else if (JDnetwork_delay>100 && JDnetwork_delay<200) {
        var JDgood_str = "网速评估:"+"您的网络延迟高于100ms，抢购可能会有影响！" 
    } 
    else {
        JDgood_str= "网速评估:"+"您的网络质量不佳，建议切换网络！" 
    }
    ui.networkTest_tree.on("click",function(){
        ui.networkTest_tree.setText("时间校准:"+"本地时间比京东" + JDoffset_str+"已经为您校准了京东时间！"+'\n'+"网络延时："+JDnetwork_delay+'\n'+JDgood_str);
        }); 
    
    });

      // 时间戳转时间字符串
    function add0(m) {
        return m < 10 ? '0' + m : m
    }
    function getNow() {
        var now = new Date().getTime();
        return now - NTPClockOffset; 
    }

    function formatDate(needTime) {
        //needTime是整数，否则要parseInt转换
        var time = new Date(parseInt(needTime));
        var h = time.getHours();
        var mm = time.getMinutes();
        var s = time.getSeconds();
        var S = time.getMilliseconds();
        return add0(h) + ':' + add0(mm) + ':' + add0(s)+":"+add0(S);
    }


      // 检测时间字符串是否有效
    function strDateTime(str) {
        var reg = /^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;
        var r = str.match(reg);
        if (r == null) return false;
        var d = new Date(r[1], r[3] - 1, r[4], r[5], r[6], r[7]);
        return (d.getFullYear() == r[1] && (d.getMonth() + 1) == r[3] && d.getDate() == r[4] && d.getHours() == r[5] && d.getMinutes() == r[6] && d.getSeconds() == r[7]);
    }
    
    var storage3 = storages.create("这个是一个文件名2");
    for (i = 0; i < 7; i++) {
    var content2 = storage3.get("password_" + (i + 1));
    
    if (content2) {
        ui["password_" + (i + 1)].setText(content2);
    }
    }

    var storage6 = storages.create("这个是一个文件名6");
    for (i = 0; i < 2; i++) {
    var content6 = storage6.get("X" + (i + 1));
    
    if (content6) {
        ui["X" + (i + 1)].setText(content6);
    }}

 
     // 京东程序主要逻辑
     ui.ok_tree.click(function () {
        // 检查无障碍服务
        if (auto.service == null) {
            toast("请先开启无障碍服务！");
            return;
    }

    //接收界面数据
    startTime_tree = ui.startTime_tree.getText().toString();
    interval = parseInt(ui.interval.getText());
    lastTime_tree = parseInt(ui.lastTime_tree.getText());
    delaytime_tree = parseInt(ui.delaytime_tree.getText());
    if (!strDateTime(startTime_tree)) {
        ui.startTime.setError("日期错误，请重新输入！");
        return;
    }
    //传递界面数据      
    storage.put("interval", interval);
    storage.put("lastTime_tree", lastTime_tree);
    storage.put("delaytime_tree", delaytime_tree);

       //按下开始运行
    if (ui.ok_tree.getText().toString() === '开始运行') {
        // 一直保持屏幕常亮
        device.keepScreenOn();
        model_change2();
        ui.ok_tree.setText('停止运行');
    } else {
        console.clear();
        console.hide();
        threads.shutDownAll();
        device.cancelKeepingAwake();
        ui.ok_tree.setText('开始运行');
    }

});  

function model_change2()
{
    if(平台类别=="京东页面"){
        device.keepScreenOn();
        threads.start(main_tree);
    }
    if(平台类别=="京东购物车"){
        device.keepScreenOn();
        threads.start(京东购物车);           
    } 
    if(平台类别=="京东BP链接"){
        device.keepScreenOn();
        threads.start(京东BP链接);           
    } 
}

 
//这是京东主程序 
function main_tree() {
    var middle = device.width / 2 -400;      
    console.setPosition(middle, 0);
    console.setGlobalLogConfig({ "file": "/sdcard/日志.txt" });
    console.show();
    var DetailPage =0;
    var notDetailPage = 0;
    var notInDetailPage = 0

    logWithTime("欢迎使用京东秒杀助手"); 
    sleep(800); 
    logWithTime("请勿用于非法用途");  
    sleep(800); 
    logWithTime("请您进入商品详情页，否则无法进行购买！");
    sleep(800); 
       
    var startTime2 = new Date(Date.parse(startTime_tree)).getTime();
    var endTime = new Date(startTime2.valueOf() + lastTime_tree* 1000).getTime();
    var Panningingtime = startTime2 - delaytime_tree;


    reviewtime();
     //判断实际时间是否大于抢购时间
function reviewtime(){
    var tt = getNow();
       if (tt > Panningingtime) {
            console.warn("您的时间已经错过了哦，请重新输入时间！");
            sleep(2000);
            console.clear();
            console.hide();
            threads.shutDownAll();
        }
       if (tt < Panningingtime){
            logWithTime("您的抢购时间为：" + formatDate(Panningingtime));
            logWithTime("距离抢购时间还剩"+(startTime2-tt)/1000+"秒"+"请耐心等待");
            }
        }
         // 检测是否在商品详情页
x = setInterval(function () {
    var t = getNow();
    if (t < Panningingtime) {
        if (className("android.widget.LinearLayout").clickable(true).depth(9).exists()) {
            if (DetailPage === 0) {
                logWithTime("已进入商品详情页，请耐心等待...");
                DetailPage++;
                notDetailPage = 0
            }

        } else {
            if (notInDetailPage === 0) {
                logWithTime("未进入商品详情页，请前往，否则无法进行购买！");
                DetailPage = 0;
                notInDetailPage++
            }
        }
    } else {
        not_in_Detail_Page = 0;  // 商品详情页状态复位
        clearInterval(x)
    }
}, 500);
    
z = setInterval(function () {
    var t = getNow();
    if(t >= Panningingtime && t < endTime){                
        logWithTime("开始抢购")
        京东页面();
        clearInterval(z);        
    }  
  },10)
};
function 京东页面()
{
    var endTime = lastTime_tree * 1000;
    var Crowding = 0;
    threads.start(function(){
        setInterval(function(){
            if (text("立即抢购").exists()) {
                logWithTime("准备点击抢购");
                click("立即抢购") 
                logWithTime("立即抢购已点击");           
             }
            },10)
        })
        threads.start(function(){
            setInterval(function(){
            if (text("立即购买").exists()) {
                logWithTime("准备点击购买");
                click("立即购买")
                logWithTime("立即购买已点击");           
                } 
            },10)
        }) 
        threads.start(function(){
            setInterval(function(){  
            if (text("提交订单").exists()) {
                    logWithTime("页面加载中");
                    logWithTime("正在尝试提交订单");
                    click("提交订单");
                    logWithTime("订单已提交");             
                }
            },10)
        }) 
        threads.start(function(){
            setInterval(function(){ 
            if (text("我知道了").exists()) {
                    click("我知道了")
                    Crowding++;
                    logWithTime("第" + Crowding + "次拥挤了，再试一次吧！");             
                    }
                },10)
            }) 
        threads.start(function(){
            setInterval(function(){ 
            if (text("确定").exists()) {
                        logWithTime("准备点击确定"); 
                        click("确定") 
                        logWithTime("确定已点击");           
                     }
                    },10)
                }) 
        threads.start(function(){
            setInterval(function(){ 
            if (className("android.widget.TextView").text("京东收银台").exists()) {
                        logWithTime("抢购成功！请支付！");
                        device.cancelKeepingAwake(); 
                        Panic_buying_end();              
                    }
                },10)
            })  
        threads.start(function(){
            setInterval(function(){ 
                sleep(endTime) 
                logWithTime("超出预定抢购时长，抢购结束");
                device.cancelKeepingAwake();
                Panic_buying_end(); 
            },10)
        })                          
}

function SN购物车()
{
    var  Crowding = 0;
    var endTime = lastTime * 1000;
         // 如果在购物车
         var 勾选 = "有"
        threads.start(function(){
        setInterval(function(){
            if(勾选 =="有"){
        if(className("android.widget.CheckBox").enabled(true).exists()){
          className("android.widget.CheckBox").enabled(true).findOne().click()
            勾选 = "无"
            click("去结算")
            click("提交订单")
        }}
        },10)
        })
       //    如果在提交订单界面
    threads.start(function(){
        setInterval(function(){
        if (className("android.widget.TextView").text("提交订单").exists()) {
            logWithTime("正在尝试提交订单");
            click("提交订单");
            logWithTime("订单已提交");
        }
        }, 10);
    });
         threads.start(function(){
            setInterval(function(){
                if(className("android.widget.TextView").text("去结算(1)").exists()){
                    logWithTime("正在尝试结算");
                    click("去结算")
                    sleep(random(10,25)) 
                    logWithTime("已结算");
                  }
                  if(className("android.widget.TextView").text("去结算(2)").exists()){
                    logWithTime("正在尝试结算");
                    click("去结算")
                    sleep(random(10,25)) 
                    logWithTime("已结算");
                   }
                   if(className("android.widget.TextView").text("去结算(3)").exists()){
                    logWithTime("正在尝试结算");
                    click("去结算")
                    sleep(random(10,25)) 
                    logWithTime("已结算");
                   }
                }, 50);
            });
            //需要领卷购买
            threads.start(function(){
                setInterval(function(){
             if(className("android.widget.TextView").text("领券结算(1)").exists()){
                logWithTime("正在尝试结算");
                click("领券结算(1)")
                sleep(random(10,25)) 
                logWithTime("已结算");
             }
             if(className("android.widget.TextView").text("领券结算(2)").exists()){
               logWithTime("正在尝试结算");
               click("领券结算(2)")
               sleep(random(10,25)) 
               logWithTime("已结算");
             }
             if(className("android.widget.TextView").text("领券结算(3)").exists()){
                logWithTime("正在尝试结算");
                click("领券结算(3)")
                sleep(random(10,25)) 
                logWithTime("已结算");
             }
             }, 50);
             });
    threads.start(function(){
        setInterval(function(){
            if (className("android.widget.TextView").text("知道了").exists()) {
                className("android.widget.TextView").text("知道了").findOne().click();
                Crowding++;
                logWithTime("第" + Crowding + "次拥挤了，再试一次吧！");             
            }
        }, 200);
    });    
            // 抢购成功
    threads.start(function(){
        setInterval(function(){
         if (className("android.widget.TextView").text("苏宁收银台").exists()) {
            logWithTime("抢购成功！请支付！");
            device.cancelKeepingAwake(); 
            Panic_buying_end()             
        }
        }, 200);
    });    
    threads.start(function(){
        setInterval(function(){
            sleep(endTime)
            logWithTime("超出预定抢购时长，抢购结束");
            device.cancelKeepingAwake();
            Panic_buying_end();
        },200)
    });   
}


//京东购物车模式
function 京东购物车() {
    var middle = device.width / 2 -400;      
    console.setPosition(middle, 0);
    console.setGlobalLogConfig({ "file": "/sdcard/日志.txt" });
    console.show();
    var DetailPage =0;
    var notDetailPage = 0;
    var notInDetailPage = 0
    var notChecked = 0

    logWithTime("欢迎使用京东秒杀助手"); 
    sleep(800); 
    logWithTime("请勿用于非法用途");  
    sleep(800); 
    logWithTime("请您进入购物车，否则无法进行购买！");
    sleep(800); 
       
    var startTime2 = new Date(Date.parse(startTime_tree)).getTime();
    var endTime = new Date(startTime2.valueOf() + lastTime_tree* 1000).getTime();
    var Panningingtime = startTime2 - delaytime_tree;


    reviewtime();
     //判断实际时间是否大于抢购时间
function reviewtime(){
    var tt = getNow();
       if (tt > Panningingtime) {
            console.warn("您的时间已经错过了哦，请重新输入时间！");
            sleep(2000);
            console.clear();
            console.hide();
            threads.shutDownAll();
        }
       if (tt < Panningingtime){
            logWithTime("您的抢购时间为：" + formatDate(Panningingtime));
            logWithTime("距离抢购时间还剩"+(startTime2-tt)/1000+"秒"+"请耐心等待");
            }
        }
         // 检测是否在商品详情页
x = setInterval(function () {
    var t = getNow();
    if (t < Panningingtime) {
        if (className("android.widget.TextView").text("购物车").depth(14).exists()) {
            if (DetailPage === 0) {
                logWithTime("已进入购物车，请耐心等待...");
                DetailPage++;
                notDetailPage = 0
            }

        } else {
            if (notInDetailPage === 0) {
                logWithTime("未进入购物车，请前往，否则无法进行购买！");
                DetailPage = 0;
                notInDetailPage++
            }
        }
    } else {
        not_in_Detail_Page = 0;  // 商品详情页状态复位
        clearInterval(x)
    }

    if (className("android.widget.TextView").text("去结算(0)").exists()) {
        if (notChecked === 0){
            notChecked = 1
            logWithTime("检测到您未勾选商品，将自动为您勾选！");
            click("全选")
        }
        }
}, 500);
    
z = setInterval(function () {
    var t = getNow();
    if(t >= Panningingtime && t < endTime){                
        logWithTime("开始抢购")
        购物车();
        clearInterval(z);        
    }  
  },10)
};
function 购物车()
{
    var endTime = lastTime_tree * 1000;
    var Crowding = 0

    threads.start(function(){
        setInterval(function(){
    if (className("android.widget.TextView").textContains("去结算(").exists()) {   
        logWithTime("准备结算");   
        className("android.widget.TextView").textContains("去结算(").findOne().click();   
        logWithTime("已结算，准备进入提交订单页面！");
     }
    },10)
    }) 
    threads.start(function(){
        setInterval(function(){ 
    if (className("android.widget.TextView").textContains("填写订单").exists()) {
        if (Crowding === 0){
            Crowding = 1
            logWithTime("页面加载中");
            }           
        }
    }, 10);
    });
    threads.start(function(){
        setInterval(function(){
            if (className("android.widget.Button").text("提交订单").exists()) {
                logWithTime("正在尝试提交订单");
                className("android.widget.Button").text("提交订单").findOne().click();
                logWithTime("订单已提交！");        
                }
        },10)
    }) 

        threads.start(function(){
            setInterval(function(){ 
            if (className("android.widget.TextView").text("京东收银台").exists()) {
                        logWithTime("抢购成功！请支付！");
                        device.cancelKeepingAwake(); 
                        Panic_buying_end();              
                    }
                },10)
            })  
        threads.start(function(){
            setInterval(function(){ 
                sleep(endTime) 
                logWithTime("超出预定抢购时长，抢购结束");
                device.cancelKeepingAwake();
                Panic_buying_end(); 
            },10)
        })                          
}


//京东BP链接
function 京东BP链接() {
    var middle = device.width / 2 -400;      
    console.setPosition(middle, 0);
    console.setGlobalLogConfig({ "file": "/sdcard/日志.txt" });
    console.show();
    var DetailPage =0;
    var notDetailPage = 0;
    var notInDetailPage = 0
    var notChecked = 0

    logWithTime("欢迎使用京东秒杀助手"); 
    sleep(800); 
    logWithTime("请勿用于非法用途");  
    sleep(800); 
    logWithTime("请您确认已打开BP链接，否则无法进行购买！");
    sleep(800); 
       
    var startTime2 = new Date(Date.parse(startTime_tree)).getTime();
    var endTime = new Date(startTime2.valueOf() + lastTime_tree* 1000).getTime();
    var Panningingtime = startTime2 - delaytime_tree;


    reviewtime();
     //判断实际时间是否大于抢购时间
function reviewtime(){
    var tt = getNow();
       if (tt > Panningingtime) {
            console.warn("您的时间已经错过了哦，请重新输入时间！");
            sleep(2000);
            console.clear();
            console.hide();
            threads.shutDownAll();
        }
       if (tt < Panningingtime){
            logWithTime("您的抢购时间为：" + formatDate(Panningingtime));
            logWithTime("距离抢购时间还剩"+(startTime2-tt)/1000+"秒"+"请耐心等待");
            }
        }
         // 检测是否在商品详情页
x = setInterval(function () {
    var t = getNow();
    if (t < Panningingtime) {
        if (className("android.widget.TextView").text("确认订单").depth(11).exists()) {
            if (DetailPage === 0) {
                logWithTime("已进入BP链接，请耐心等待...");
                DetailPage++;
                notDetailPage = 0
            }

        } else {
            if (notInDetailPage === 0) {
                logWithTime("未进入BP链接，请前往，否则无法进行购买！");
                DetailPage = 0;
                notInDetailPage++
            }
        }
    } else {
        not_in_Detail_Page = 0;  // 商品详情页状态复位
        clearInterval(x)
    }
}, 500);
    
z = setInterval(function () {
    var t = getNow();
    if(t >= Panningingtime && t < endTime){                
        logWithTime("开始抢购")
        bp支付()
        clearInterval(z);        
    }  
  },10)
};
function bp支付()
{
    var endTime = lastTime_tree * 1000;

    threads.start(function(){
        setInterval(function(){
        if(className("android.view.View").text("微信支付").exists()){
            logWithTime("准备点击微信支付");
            className("android.view.View").text("微信支付").findOne().click()
            logWithTime("已点击微信支付");
            }
    },10)
    }) 

        threads.start(function(){
            setInterval(function(){ 
            if (className("android.view.ViewGroup").depth(17).exists()) {
                        logWithTime("抢购成功！请支付！");
                        device.cancelKeepingAwake(); 
                        Panic_buying_end();              
                    }
                },10)
        })  
        threads.start(function(){
            setInterval(function(){ 
                sleep(endTime) 
                logWithTime("超出预定抢购时长，抢购结束");
                device.cancelKeepingAwake();
                Panic_buying_end(); 
            },10)
        })                          
}

function 获取坐标(){
    console.show()
    console.info("请前往提交订单页面，否则无法获取坐标！")
    sleep(1000)
    console.info("30秒内未进入提交订单页面，获取坐标就会自动停止！")
    var 找按钮 = "有"
    threads.start(function(){
    setInterval(function(){ 
        if(className("android.widget.TextView").text("提交订单").exists()&&找按钮=="有"){
        var 提交订单= className("android.widget.TextView").text("提交订单").findOne()
        console.info("您的X轴坐标是:"+提交订单.bounds().centerX(),"\n您的Y轴坐标是:"+提交订单.bounds().centerY())
        找按钮="无"
        console.info("获取坐标成功！")
        threads.shutDownAll();
        }
    }, 100);
    }); 

    threads.start(function(){
        setInterval(function(){ 
            sleep(30000)
            console.info("获取坐标超时，已停止！")
            console.clear();
            console.hide();
            threads.shutDownAll();
            device.cancelKeepingAwake();   
        }, 100);
        }); 
    }
//=====================================================================================拼多多
    function Panic_buying_end(){    
        device.cancelKeepingAwake()//关闭屏幕常亮
        logWithTime("本次抢购结束");
        threads.shutDownAll()
    }

       //初始化淘宝界面
       setTimeout(initConfig_two, 500);
       function initConfig_two() {
           NTPClockOffset = storage.get("NTPClockOffset", "0");
           NTPClockDelay = storage.get("NTPClockDelay", "0");
       if (!NTPClockOffset) {
           NTPClockOffset = 0;
       } else {
           NTPClockOffset = parseInt(NTPClockOffset.split("|")[0]);
       }
       if (NTPClockOffset < 0) {
           var offset_str = "慢了" + -NTPClockOffset + 'ms，'
       } else {
           offset_str = "快了" + NTPClockOffset + 'ms，'
       }
       if (NTPClockDelay < 50) {
           var good_str = "网速评估:"+"您的网络延迟低于50ms，非常优秀！" 
       } 
       else if (NTPClockDelay < 100) {
           var good_str = "网速评估:"+"您的网络延迟低于100ms，优秀！" 
       } 
       else if (NTPClockDelay>100 && NTPClockDelay<200) {
           var good_str = "网速评估:"+"您的网络延迟高于100ms，抢购可能会有影响！" 
       } 
       else {
           good_str = "网速评估:"+"您的网络质量不佳，建议切换网络！" 
       }
   
         }

